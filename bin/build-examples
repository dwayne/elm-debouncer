#!/usr/bin/env bash

set -e

src_dir="$project/examples"
web_root="${web_root%/}"
dest_dir="$build$web_root"

prepare_dest_dir () {
  mkdir -p "$dest_dir"
}

build_html () {
  local name

  for html_file in "$src_dir"/html/*.html; do
    name=${html_file##/*/}
    sed "s|{{ROOT}}|$web_root|" "$html_file" > "$dest_dir/$name"
  done
}

build_css () {
  cp "$src_dir"/css/*.css "$dest_dir"
}

build_js () {
  local name

  pushd "$src_dir"

  for elm_file in src/*.elm; do
    name="${elm_file#src/}" # Remove src/ prefix
    name="${name%.elm}"     # Remove .elm suffix
    name="${name,}"         # Convert the first character to lowercase

    elm make "$elm_file" --debug --output "$dest_dir/$name.js"
  done

  popd
}

prepare_dest_dir && build_html && build_css && build_js
